
var Salvation={};Salvation.Core={};Salvation.Video={};Salvation.Scene={};Salvation.Gui={};var DegToRadCoefficient=Math.PI/180;Salvation.Device=function(p_Canvas){this.Type="Salvation.Device";this.Canvas=p_Canvas;this.GlContext=null;if(p_Canvas.addEventListener)
{p_Canvas.addEventListener("webglcontextcreationerror",function(p_Event){if(p_Canvas.parentNode)
{this.ErrorStr=window.WebGLRenderingContext?"It doesn't appear your computer can support WebGL.":"This page requires a browser that supports WebGL.";if(p_Event.statusMessage)
this.ErrorStr+=" Error : "+p_Event.statusMessage;}},false);}
try
{var l_ContextNames=["webgl","experimental-webgl","webkit-3d","moz-webgl"];for(var l_I=0;l_I<l_ContextNames.length;++l_I)
{if(this.GlContext)
continue;try
{this.GlContext=p_Canvas.getContext(l_ContextNames[l_I]);}
catch(l_Exception)
{}}
this.GlContext.viewportWidth=p_Canvas.width;this.GlContext.viewportHeight=p_Canvas.height;}
catch(l_Exception)
{}
this.IsCreated=Salvation.Device_IsCreated;if(this.IsCreated)
{this.VideoDriver=new Salvation.Video.Driver(this);this.VideoDriver.BeginScene();this.VideoDriver.EndScene();this.SceneManager=new Salvation.Scene.Manager(this);}};Salvation.Device_IsCreated=function(){if(this.GlContext)
return true;return false;}
Salvation.Core.Matrix4=function(){this.Type="Salvation.Core.Matrix4";this.Values=(typeof Float32Array!=='undefined')?new Float32Array(16):new Array(16);for(l_I=0;l_I<16;++l_I)
this.Values[l_I]=0;this.Import=Salvation.Core.Matrix4_Import;this.Perspective=Salvation.Core.Matrix4_Perspective;this.Rotate=Salvation.Core.Matrix4_Rotate;this.RotateXYZ=Salvation.Core.Matrix4_RotateXYZ;this.Translate=Salvation.Core.Matrix4_Translate;this.Scale=Salvation.Core.Matrix4_Scale;this.Identity=Salvation.Core.Matrix4_Identity;this.Multiply=Salvation.Core.Matrix4_Multiply;};Salvation.Core.Matrix4_Import=function(p_Src){for(l_I=0;l_I<16;++l_I)
this.Values[l_I]=p_Src.Values[l_I];};Salvation.Core.Matrix4_Perspective=function(p_Fovy,p_Aspect,p_Near,p_Far){l_NF=1/(p_Near-p_Far);l_F=(1.0/Math.tan(p_Fovy/2));this.Values[0]=l_F/p_Aspect;this.Values[1]=0;this.Values[2]=0;this.Values[3]=0;this.Values[4]=0;this.Values[5]=l_F;this.Values[6]=0;this.Values[7]=0;this.Values[8]=0;this.Values[9]=0;this.Values[10]=(p_Far+p_Near)*l_NF;this.Values[11]=-1;this.Values[12]=0;this.Values[13]=0;this.Values[14]=(2*p_Far*p_Near)*l_NF;this.Values[15]=0;};Salvation.Core.Matrix4_Rotate=function(p_Rad,p_Axis){var l_XAxis=p_Axis[0],l_YAxis=p_Axis[1],l_ZAxis=p_Axis[2];var l_Len=Math.sqrt(l_XAxis*l_XAxis+l_YAxis*l_YAxis+l_ZAxis*l_ZAxis);var l_S,l_C,l_T;if(Math.abs(l_Len)<0.000001)
return;l_Len=1/l_Len;l_XAxis*=l_Len;l_YAxis*=l_Len;l_ZAxis*=l_Len;l_S=Math.sin(p_Rad);l_C=Math.cos(p_Rad);l_T=1-l_C;var l_B00=l_XAxis*l_XAxis*l_T+l_C;var l_B01=l_YAxis*l_XAxis*l_T+l_ZAxis*l_S;var l_B02=l_ZAxis*l_XAxis*l_T-l_YAxis*l_S;var l_B10=l_XAxis*l_YAxis*l_T-l_ZAxis*l_S;var l_B11=l_YAxis*l_YAxis*l_T+l_C;var l_B12=l_ZAxis*l_YAxis*l_T+l_XAxis*l_S;var l_B20=l_XAxis*l_ZAxis*l_T+l_YAxis*l_S;var l_B21=l_YAxis*l_ZAxis*l_T-l_XAxis*l_S;var l_B22=l_ZAxis*l_ZAxis*l_T+l_C;var l_Values=(typeof Float32Array!=='undefined')?new Float32Array(16):new Array(16);l_Values[0]=this.Values[0]*l_B00+this.Values[4]*l_B01+this.Values[8]*l_B02;l_Values[1]=this.Values[1]*l_B00+this.Values[5]*l_B01+this.Values[9]*l_B02;l_Values[2]=this.Values[2]*l_B00+this.Values[6]*l_B01+this.Values[10]*l_B02;l_Values[3]=this.Values[3]*l_B00+this.Values[7]*l_B01+this.Values[11]*l_B02;l_Values[4]=this.Values[0]*l_B10+this.Values[4]*l_B11+this.Values[8]*l_B12;l_Values[5]=this.Values[1]*l_B10+this.Values[5]*l_B11+this.Values[9]*l_B12;l_Values[6]=this.Values[2]*l_B10+this.Values[6]*l_B11+this.Values[10]*l_B12;l_Values[7]=this.Values[3]*l_B10+this.Values[7]*l_B11+this.Values[11]*l_B12;l_Values[8]=this.Values[0]*l_B20+this.Values[4]*l_B21+this.Values[8]*l_B22;l_Values[9]=this.Values[1]*l_B20+this.Values[5]*l_B21+this.Values[9]*l_B22;l_Values[10]=this.Values[2]*l_B20+this.Values[6]*l_B21+this.Values[10]*l_B22;l_Values[11]=this.Values[3]*l_B20+this.Values[7]*l_B21+this.Values[11]*l_B22;l_Values[12]=this.Values[12];l_Values[13]=this.Values[13];l_Values[14]=this.Values[14];l_Values[15]=this.Values[15];this.Values=l_Values;};Salvation.Core.Matrix4_RotateXYZ=function(p_X,p_Y,p_Z){this.Rotate(p_X,[1,0,0]);this.Rotate(p_Y,[0,1,0]);this.Rotate(p_Z,[0,0,1]);};Salvation.Core.Matrix4_Translate=function(p_X,p_Y,p_Z){this.Values[12]=this.Values[0]*p_X+this.Values[4]*p_Y+this.Values[8]*p_Z+this.Values[12];this.Values[13]=this.Values[1]*p_X+this.Values[5]*p_Y+this.Values[9]*p_Z+this.Values[13];this.Values[14]=this.Values[2]*p_X+this.Values[6]*p_Y+this.Values[10]*p_Z+this.Values[14];this.Values[15]=this.Values[3]*p_X+this.Values[7]*p_Y+this.Values[11]*p_Z+this.Values[15];};Salvation.Core.Matrix4_Scale=function(p_X,p_Y,p_Z){for(l_I=0;l_I<4;++l_I)
this.Values[l_I]*=p_X;for(l_I=4;l_I<8;++l_I)
this.Values[l_I]*=p_Y;for(l_I=8;l_I<12;++l_I)
this.Values[l_I]*=p_Z;};Salvation.Core.Matrix4_Identity=function(){for(l_I=0;l_I<16;++l_I)
this.Values[l_I]=0;this.Values[0]=1;this.Values[5]=1;this.Values[10]=1;this.Values[15]=1;};Salvation.Core.Matrix4_Multiply=function(p_Other){var l_Values=(typeof Float32Array!=='undefined')?new Float32Array(16):new Array(16);l_Values[0]=p_Other.Values[0]*this.Values[0]+p_Other.Values[1]*this.Values[4]+p_Other.Values[2]*this.Values[8]+p_Other.Values[3]*this.Values[12];l_Values[1]=p_Other.Values[0]*this.Values[1]+p_Other.Values[1]*this.Values[5]+p_Other.Values[2]*this.Values[9]+p_Other.Values[3]*this.Values[13];l_Values[2]=p_Other.Values[0]*this.Values[2]+p_Other.Values[1]*this.Values[6]+p_Other.Values[2]*this.Values[10]+p_Other.Values[3]*this.Values[14];l_Values[3]=p_Other.Values[0]*this.Values[3]+p_Other.Values[1]*this.Values[7]+p_Other.Values[2]*this.Values[11]+p_Other.Values[3]*this.Values[15];l_Values[4]=p_Other.Values[4]*this.Values[0]+p_Other.Values[5]*this.Values[4]+p_Other.Values[6]*this.Values[8]+p_Other.Values[7]*this.Values[12];l_Values[5]=p_Other.Values[4]*this.Values[1]+p_Other.Values[5]*this.Values[5]+p_Other.Values[6]*this.Values[9]+p_Other.Values[7]*this.Values[13];l_Values[6]=p_Other.Values[4]*this.Values[2]+p_Other.Values[5]*this.Values[6]+p_Other.Values[6]*this.Values[10]+p_Other.Values[7]*this.Values[14];l_Values[7]=p_Other.Values[4]*this.Values[3]+p_Other.Values[5]*this.Values[7]+p_Other.Values[6]*this.Values[11]+p_Other.Values[7]*this.Values[15];l_Values[8]=p_Other.Values[8]*this.Values[0]+p_Other.Values[9]*this.Values[4]+p_Other.Values[10]*this.Values[8]+p_Other.Values[11]*this.Values[12];l_Values[9]=p_Other.Values[8]*this.Values[1]+p_Other.Values[9]*this.Values[5]+p_Other.Values[10]*this.Values[9]+p_Other.Values[11]*this.Values[13];l_Values[10]=p_Other.Values[8]*this.Values[2]+p_Other.Values[9]*this.Values[6]+p_Other.Values[10]*this.Values[10]+p_Other.Values[11]*this.Values[14];l_Values[11]=p_Other.Values[8]*this.Values[3]+p_Other.Values[9]*this.Values[7]+p_Other.Values[10]*this.Values[11]+p_Other.Values[11]*this.Values[15];l_Values[12]=p_Other.Values[12]*this.Values[0]+p_Other.Values[13]*this.Values[4]+p_Other.Values[14]*this.Values[8]+p_Other.Values[15]*this.Values[12];l_Values[13]=p_Other.Values[12]*this.Values[1]+p_Other.Values[13]*this.Values[5]+p_Other.Values[14]*this.Values[9]+p_Other.Values[15]*this.Values[13];l_Values[14]=p_Other.Values[12]*this.Values[2]+p_Other.Values[13]*this.Values[6]+p_Other.Values[14]*this.Values[10]+p_Other.Values[15]*this.Values[14];l_Values[15]=p_Other.Values[12]*this.Values[3]+p_Other.Values[13]*this.Values[7]+p_Other.Values[14]*this.Values[11]+p_Other.Values[15]*this.Values[15];this.Values=l_Values;};Salvation.Core.Vector3=function(p_X,p_Y,p_Z){this.Type="Salvation.Core.Vector3";if(p_Z!==undefined)
{this.X=p_X;this.Y=p_Y;this.Z=p_Z;}
else
{this.X=0;this.Y=0;this.Z=0;}};Salvation.Video.Color=function(p_R,p_G,p_B,p_A){this.Type="Salvation.Video.Color";if(p_A!==undefined)
{this.R=p_R;this.G=p_G;this.B=p_B;this.A=p_A;}
else
{this.R=0;this.G=0;this.B=0;this.A=0;}};Salvation.Video.Driver=function(p_Device){this.Type="Salvation.Video.Driver";this.Device=p_Device;this.ClearColor=new Salvation.Video.Color(0.0,0.0,0.0,1.0);this.ProjectionMatrix=new Salvation.Core.Matrix4();this.ModelViewMatrix=new Salvation.Core.Matrix4();this.ModelViewStack=[];p_Device.GlContext.enable(p_Device.GlContext.DEPTH_TEST);p_Device.GlContext.clearColor(this.ClearColor.R,this.ClearColor.G,this.ClearColor.B,this.ClearColor.A);this.DefaultShader=new Salvation.Video.Shader(this,DefaultFragmentProgram,DefaultVertexProgram);this.DefaultShader.Init=DefaultProgramInitFunction;this.DefaultShader.Bind=DefaultProgramBindFunction;this.DefaultShader.Init();this.Device.GlContext.viewport(0,0,this.Device.GlContext.viewportWidth,this.Device.GlContext.viewportHeight);this.ProjectionMatrix.Perspective(45,this.Device.GlContext.viewportWidth/this.Device.GlContext.viewportHeight,0.1,100.0);this.ModelViewMatrix.Identity();this.BeginScene=Salvation.Video.Driver_BeginScene;this.EndScene=Salvation.Video.Driver_EndScene;this.DrawMesh=Salvation.Video.Driver_DrawMesh;this.PushModelView=Salvation.Video.Driver_PushModelView;this.PopModelView=Salvation.Video.Driver_PopModelView;this.UpdateClearColor=Salvation.Video.Driver_UpdateClearColor;this.GetDefaultShader=Salvation.Video.Driver_GetDefaultShader;this.CreateMesh=Salvation.Video.Driver_CreateMesh;this.CreateMaterial=Salvation.Video.Driver_CreateMaterial;};Salvation.Video.Driver_BeginScene=function(){this.Device.GlContext.clear(this.Device.GlContext.COLOR_BUFFER_BIT|this.Device.GlContext.DEPTH_BUFFER_BIT);};Salvation.Video.Driver_EndScene=function(){};Salvation.Video.Driver_DrawMesh=function(p_Mesh,p_Material,p_Position,p_Scale,p_Rotation){this.PushModelView();this.ModelViewMatrix.Translate(p_Position.X,p_Position.Y,p_Position.Z);this.ModelViewMatrix.RotateXYZ(p_Rotation.X*DegToRadCoefficient,p_Rotation.Y*DegToRadCoefficient,p_Rotation.Z*DegToRadCoefficient);this.ModelViewMatrix.Scale(p_Scale.X,p_Scale.Y,p_Scale.Z);this.Device.GlContext.useProgram(p_Material.Shader.Program);p_Material.Shader.Bind(p_Mesh);this.Device.GlContext.bindBuffer(this.Device.GlContext.ELEMENT_ARRAY_BUFFER,p_Mesh.IndiceBufferPtr);this.Device.GlContext.drawElements(this.Device.GlContext.TRIANGLES,p_Mesh.IndiceBufferPtr.numItems,this.Device.GlContext.UNSIGNED_SHORT,0);this.PopModelView();};Salvation.Video.Driver_PushModelView=function(){var l_Copy=new Salvation.Core.Matrix4();l_Copy.Import(this.ModelViewMatrix);this.ModelViewStack.push(l_Copy);}
Salvation.Video.Driver_PopModelView=function(){if(this.ModelViewStack.length==0)
return;this.ModelViewMatrix=this.ModelViewStack.pop();}
Salvation.Video.Driver_UpdateClearColor=function(){this.Device.GlContext.clearColor(this.ClearColor.R,this.ClearColor.G,this.ClearColor.B,this.ClearColor.A);};Salvation.Video.Driver_GetDefaultShader=function(){return this.DefaultShader;}
Salvation.Video.Driver_CreateMesh=function(p_Name){return new Salvation.Video.Mesh(this,p_Name);}
Salvation.Video.Driver_CreateMaterial=function(){return new Salvation.Video.Material(this);}
Salvation.Video.Material=function(p_VideoDriver){this.Type="Salvation.Video.Material";this.Texture=0;this.Shader=p_VideoDriver.GetDefaultShader();};Salvation.Video.Mesh=function(p_VideoDriver,p_Name){this.Type="Salvation.Video.Mesh";this.VideoDriver=p_VideoDriver;this.Name=p_Name;this.VertexBuffer=(typeof Float32Array!=='undefined')?new Float32Array():new Array();this.ColorBuffer=(typeof Float32Array!=='undefined')?new Float32Array():new Array();this.UVBuffer=(typeof Float32Array!=='undefined')?new Float32Array():new Array();this.IndiceBuffer=(typeof Uint16Array!=='undefined')?new Uint16Array():new Array();this.VertexBufferPtr=p_VideoDriver.Device.GlContext.createBuffer();this.ColorBufferPtr=p_VideoDriver.Device.GlContext.createBuffer();this.UVBufferPtr=p_VideoDriver.Device.GlContext.createBuffer();this.IndiceBufferPtr=p_VideoDriver.Device.GlContext.createBuffer();this.VertexBufferPtr.itemSize=3;this.ColorBufferPtr.itemSize=4;this.UVBufferPtr.itemSize=2;this.IndiceBufferPtr.itemSize=1;this.Release=Salvation.Video.Mesh_Release;this.UpdateBuffers=Salvation.Video.Mesh_UpdateBuffers;};Salvation.Video.Mesh_Release=function(){this.VideoDriver.Device.GlContext.deleteBuffer(this.VertexBufferPtr);this.VideoDriver.Device.GlContext.deleteBuffer(this.ColorBufferPtr);this.VideoDriver.Device.GlContext.deleteBuffer(this.UVBufferPtr);this.VideoDriver.Device.GlContext.deleteBuffer(this.IndiceBufferPtr);};Salvation.Video.Mesh_UpdateBuffers=function(){this.VideoDriver.Device.GlContext.bindBuffer(this.VideoDriver.Device.GlContext.ARRAY_BUFFER,this.VertexBufferPtr);this.VideoDriver.Device.GlContext.bufferData(this.VideoDriver.Device.GlContext.ARRAY_BUFFER,new Float32Array(this.VertexBuffer),this.VideoDriver.Device.GlContext.STATIC_DRAW);this.VertexBufferPtr.numItems=this.VertexBuffer.length/3;this.VideoDriver.Device.GlContext.bindBuffer(this.VideoDriver.Device.GlContext.ARRAY_BUFFER,this.ColorBufferPtr);this.VideoDriver.Device.GlContext.bufferData(this.VideoDriver.Device.GlContext.ARRAY_BUFFER,new Float32Array(this.ColorBuffer),this.VideoDriver.Device.GlContext.STATIC_DRAW);this.ColorBufferPtr.numItems=this.ColorBuffer.length/4;this.VideoDriver.Device.GlContext.bindBuffer(this.VideoDriver.Device.GlContext.ARRAY_BUFFER,this.UVBufferPtr);this.VideoDriver.Device.GlContext.bufferData(this.VideoDriver.Device.GlContext.ARRAY_BUFFER,new Float32Array(this.UVBuffer),this.VideoDriver.Device.GlContext.STATIC_DRAW);this.UVBufferPtr.numItems=this.UVBuffer.length/2;this.VideoDriver.Device.GlContext.bindBuffer(this.VideoDriver.Device.GlContext.ELEMENT_ARRAY_BUFFER,this.IndiceBufferPtr);this.VideoDriver.Device.GlContext.bufferData(this.VideoDriver.Device.GlContext.ELEMENT_ARRAY_BUFFER,new Uint16Array(this.IndiceBuffer),this.VideoDriver.Device.GlContext.STATIC_DRAW);this.IndiceBufferPtr.numItems=this.IndiceBuffer.length;};DefaultFragmentProgram="precision mediump float;"
DefaultFragmentProgram+="varying vec4 Color;";DefaultFragmentProgram+="void main(void) {";DefaultFragmentProgram+="     gl_FragColor = Color;";DefaultFragmentProgram+="}";DefaultVertexProgram="attribute vec3 VertexPosition;";DefaultVertexProgram+="attribute vec4 VertexColor;";DefaultVertexProgram+="uniform mat4 ProjModelViewMatrix;";DefaultVertexProgram+="varying vec4 Color;";DefaultVertexProgram+="void main(void) {";DefaultVertexProgram+="       gl_Position  = ProjModelViewMatrix * vec4(VertexPosition, 1.0);";DefaultVertexProgram+="       Color    = VertexColor;";DefaultVertexProgram+="}";DefaultProgramInitFunction=function(){this.a_VertexPosition=this.GetAttributeLocation("VertexPosition");this.a_VertexColor=this.GetAttributeLocation("VertexColor");this.u_ProjModelViewMatrix=this.GetUniformLocation("ProjModelViewMatrix");this.SetIsArrayAttribute(this.a_VertexPosition,true);this.SetIsArrayAttribute(this.a_VertexColor,true);}
DefaultProgramBindFunction=function(p_Mesh){this.l_ComputedMatrix=new Salvation.Core.Matrix4();this.l_ComputedMatrix.Import(this.VideoDriver.ProjectionMatrix);this.l_ComputedMatrix.Multiply(this.VideoDriver.ModelViewMatrix);this.SetUniformMatrix4FV(this.u_ProjModelViewMatrix,false,this.l_ComputedMatrix);this.SetAttributeVertexPointerFloat(this.a_VertexPosition,p_Mesh.VertexBufferPtr);this.SetAttributeVertexPointerFloat(this.a_VertexColor,p_Mesh.ColorBufferPtr);}
Salvation.Video.Shader=function(p_VideoDriver,p_FragStr,p_VertStr){this.Type="Salvation.Video.Shader";this.VideoDriver=p_VideoDriver;this.Fragment=p_VideoDriver.Device.GlContext.createShader(p_VideoDriver.Device.GlContext.FRAGMENT_SHADER);this.Vertex=p_VideoDriver.Device.GlContext.createShader(p_VideoDriver.Device.GlContext.VERTEX_SHADER);this.Program=p_VideoDriver.Device.GlContext.createProgram();p_VideoDriver.Device.GlContext.shaderSource(this.Fragment,p_FragStr);p_VideoDriver.Device.GlContext.compileShader(this.Fragment);if(!p_VideoDriver.Device.GlContext.getShaderParameter(this.Fragment,p_VideoDriver.Device.GlContext.COMPILE_STATUS))
{this.FragmentErrorStr=p_VideoDriver.Device.GlContext.getShaderInfoLog(this.Fragment);this.IsFramgmentCreated=false;}
else
{this.IsFramgmentCreated=true;}
p_VideoDriver.Device.GlContext.shaderSource(this.Vertex,p_VertStr);p_VideoDriver.Device.GlContext.compileShader(this.Vertex);if(!p_VideoDriver.Device.GlContext.getShaderParameter(this.Vertex,p_VideoDriver.Device.GlContext.COMPILE_STATUS))
{this.VertexErrorStr=p_VideoDriver.Device.GlContext.getShaderInfoLog(this.Vertex);this.IsVertexCreated=false;}
else
{this.IsVertexCreated=true;}
p_VideoDriver.Device.GlContext.attachShader(this.Program,this.Vertex);p_VideoDriver.Device.GlContext.attachShader(this.Program,this.Fragment);p_VideoDriver.Device.GlContext.linkProgram(this.Program);if(!p_VideoDriver.Device.GlContext.getProgramParameter(this.Program,p_VideoDriver.Device.GlContext.LINK_STATUS))
this.IsProgramCreated=false;else
this.IsProgramCreated=true;this.IsCreated=Salvation.Video.Shader_IsCreated;this.SetIsArrayAttribute=Salvation.Video.Shader_SetIsArrayAttribute;this.GetAttributeLocation=Salvation.Video.Shader_GetAttributeLocation;this.GetUniformLocation=Salvation.Video.Shader_GetUniformLocation;this.SetUniformMatrix4FV=Salvation.Video.Shader_SetUniformMatrix4FV;this.SetAttributeVertexPointerFloat=Salvation.Video.Shader_SetAttributeVertexPointerFloat;this.Init=function(){};this.Bind=function(p_Mesh){};};Salvation.Video.Shader_IsCreated=function(){return this.IsProgramCreated&&this.IsVertexCreated&&this.IsFramgmentCreated;}
Salvation.Video.Shader_SetIsArrayAttribute=function(p_Location,p_State){if(p_State)
this.VideoDriver.Device.GlContext.enableVertexAttribArray(p_Location);else
this.VideoDriver.Device.GlContext.disableVertexAttribArray(p_Location);}
Salvation.Video.Shader_GetAttributeLocation=function(p_Name){return this.VideoDriver.Device.GlContext.getAttribLocation(this.Program,p_Name);};Salvation.Video.Shader_GetUniformLocation=function(p_Name){return this.VideoDriver.Device.GlContext.getUniformLocation(this.Program,p_Name);};Salvation.Video.Shader_SetUniformMatrix4FV=function(p_Location,p_Transpose,p_Matrix){this.VideoDriver.Device.GlContext.uniformMatrix4fv(p_Location,p_Transpose,p_Matrix.Values);};Salvation.Video.Shader_SetAttributeVertexPointerFloat=function(p_Location,p_Pointer){this.VideoDriver.Device.GlContext.bindBuffer(this.VideoDriver.Device.GlContext.ARRAY_BUFFER,p_Pointer);this.VideoDriver.Device.GlContext.vertexAttribPointer(p_Location,p_Pointer.itemSize,this.VideoDriver.Device.GlContext.FLOAT,false,0,0);};Salvation.Scene.CubeNode=function(p_SceneManager,p_Name,p_Size){this.Node=new Salvation.Scene.Node(p_SceneManager,p_Name);this.Type="Salvation.Scene.CubeNode";this.Node.Mesh.VertexBuffer=[-p_Size,-p_Size,p_Size,p_Size,-p_Size,p_Size,p_Size,p_Size,p_Size,-p_Size,p_Size,p_Size,-p_Size,-p_Size,-p_Size,-p_Size,p_Size,-p_Size,p_Size,p_Size,-p_Size,p_Size,-p_Size,-p_Size,-p_Size,p_Size,-p_Size,-p_Size,p_Size,p_Size,p_Size,p_Size,p_Size,p_Size,p_Size,-p_Size,-p_Size,-p_Size,-p_Size,p_Size,-p_Size,-p_Size,p_Size,-p_Size,p_Size,-p_Size,-p_Size,p_Size,p_Size,-p_Size,-p_Size,p_Size,p_Size,-p_Size,p_Size,p_Size,p_Size,p_Size,-p_Size,p_Size,-p_Size,-p_Size,-p_Size,-p_Size,-p_Size,p_Size,-p_Size,p_Size,p_Size,-p_Size,p_Size,-p_Size,];this.Node.Mesh.IndiceBuffer=[0,1,2,0,2,3,4,5,6,4,6,7,8,9,10,8,10,11,12,13,14,12,14,15,16,17,18,16,18,19,20,21,22,20,22,23];this.Node.Mesh.UVBuffer=[0.0,0.0,1.0,0.0,1.0,1.0,0.0,1.0,1.0,0.0,1.0,1.0,0.0,1.0,0.0,0.0,0.0,1.0,0.0,0.0,1.0,0.0,1.0,1.0,1.0,1.0,0.0,1.0,0.0,0.0,1.0,0.0,1.0,0.0,1.0,1.0,0.0,1.0,0.0,0.0,0.0,0.0,1.0,0.0,1.0,1.0,0.0,1.0];var l_Colors=new Array();for(l_I=0;l_I<4*4*6;)
{l_Colors.push(0.5);l_Colors.push(0.5);l_Colors.push(0.5);l_Colors.push(1);l_I+=4;}
this.Node.Mesh.ColorBuffer=new Float32Array(l_Colors);this.Node.Mesh.UpdateBuffers();};Salvation.Scene.Manager=function(p_Device){this.Type="Salvation.Scene.Manager";this.Device=p_Device;this.Nodes=new Array();this.DrawAll=Salvation.Scene.Manager_DrawAll;this.AddCubeSceneNode=Salvation.Scene.Manager_AddCubeSceneNode;};Salvation.Scene.Manager_DrawAll=function(){for(var l_I=0;l_I<this.Nodes.length;++l_I)
{if(this.Nodes[l_I].Draw)
this.Nodes[l_I].Draw();else
this.Nodes[l_I].Node.Draw();}};Salvation.Scene.Manager_AddCubeSceneNode=function(p_Name,p_Size){l_Object=new Salvation.Scene.CubeNode(this,p_Name,p_Size);this.Nodes.push(l_Object);return l_Object;};Salvation.Scene.Node=function(p_SceneManager,p_Name){this.Type="Salvation.Scene.Node";this.Name=p_Name;this.SceneManager=p_SceneManager;this.Position=new Salvation.Core.Vector3();this.Rotation=new Salvation.Core.Vector3();this.Scale=new Salvation.Core.Vector3(1,1,1);this.Mesh=p_SceneManager.Device.VideoDriver.CreateMesh(p_Name+"_Mesh");this.Material=p_SceneManager.Device.VideoDriver.CreateMaterial();this.Draw=Salvation.Scene.Manager_Draw;};Salvation.Scene.Manager_Draw=function(){this.SceneManager.Device.VideoDriver.DrawMesh(this.Mesh,this.Material,this.Position,this.Scale,this.Rotation);};